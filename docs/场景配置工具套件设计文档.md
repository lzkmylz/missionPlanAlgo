# 场景配置工具套件设计文档

## 背景

在卫星星座任务规划实验过程中，直接编辑 JSON 场景文件存在以下问题：
- 容易出错（格式错误、参数越界、缺少必填字段）
- 重复配置繁琐（如创建多颗相似卫星）
- 难以维护（多个场景使用相同实体时需复制粘贴）

## 目标

1. 提供场景文件校验工具，确保配置合法
2. 提供实体库管理，支持卫星/目标/地面站的快速增删改查
3. 支持基于模板生成 Walker 星座

## 架构设计

```
┌─────────────────────────────────────────────────────────────┐
│                    场景配置工具套件                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  实体库 (Entity Library)              │   │
│  │           位置: data/entity_lib/                      │   │
│  ├─────────────────┬─────────────────┬─────────────────┤   │
│  │  satellites/    │   targets/      │  ground_stations/│   │
│  │  卫星模板库      │   目标库         │   地面站库        │   │
│  └─────────────────┴─────────────────┴─────────────────┘   │
│                            │                                │
│                            ▼                                │
│              ┌─────────────────────────┐                    │
│              │    ScenarioBuilder      │                    │
│              │    (场景构建核心)        │                    │
│              └─────────────────────────┘                    │
│                            │                                │
│         ┌──────────────────┼──────────────────┐             │
│         ▼                  ▼                  ▼             │
│    ┌─────────┐       ┌─────────┐       ┌─────────┐         │
│    │validate │       │  edit   │       │ walker  │         │
│    │ 校验工具 │       │ 编辑工具 │       │星座生成器│         │
│    └─────────┘       └─────────┘       └─────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 实体库结构

```
data/entity_lib/
├── satellites/                    # 卫星模板
│   ├── optical_1.json             # 光学1型（推扫）
│   ├── optical_2.json             # 光学2型（框幅）
│   ├── sar_1.json                 # SAR 1型（条带）
│   └── sar_2.json                 # SAR 2型（聚束/滑动聚束）
│
├── targets/
│   ├── point/                     # 点目标
│   │   ├── beijing.json
│   │   ├── shanghai.json
│   │   └── ...
│   └── area/                      # 区域目标
│       ├── north_china.json
│       └── ...
│
└── ground_stations/               # 地面站
    ├── beijing_gs.json
    ├── kashi_gs.json
    └── ...
```

## 卫星模板格式

```json
{
  "template_id": "optical_1",
  "name": "光学卫星1型模板",
  "sat_type": "optical_1",
  "orbit": {
    "orbit_type": "SSO",
    "altitude": 645000,
    "inclination": 97.9,
    "repeat_cycle_days": 41
  },
  "capabilities": {
    "imaging_modes": ["push_broom"],
    "max_off_nadir": 30.0,
    "storage_capacity": 500,
    "power_capacity": 2000,
    "data_rate": 300
  }
}
```

## 场景文件格式（全量数据存储）

**重要**：为保证实验可复现性和场景自包含性，每个场景文件保存**全量数据**，不依赖外部文件。

```json
{
  "name": "测试场景",
  "description": "基于optical_1模板的测试",
  "start_time": "2024-01-01T00:00:00Z",
  "end_time": "2024-01-02T00:00:00Z",
  "metadata": {
    "coordinate_system": "WGS84",
    "time_system": "UTC",
    "time_format": "ISO8601",
    "created_at": "2024-01-01T00:00:00Z",
    "version": "1.0"
  },
  "satellites": [
    {
      "id": "OPT-01",
      "name": "光学卫星01",
      "sat_type": "optical_1",
      "_template_source": "optical_1",
      "_template_version": "1.0",
      "orbit": {
        "orbit_type": "SSO",
        "altitude": 645000,
        "inclination": 97.9
      },
      "capabilities": {
        "imaging_modes": ["push_broom"],
        "max_off_nadir": 30.0,
        "storage_capacity": 500,
        "power_capacity": 2000,
        "data_rate": 300
      }
    }
  ],
  "targets": [...],
  "ground_stations": [...]
}
```

## 命令行接口

### 命令别名（setup.py entry_points）

在 `setup.py` 中配置全局命令别名：

```python
setup(
    ...
    entry_points={
        'console_scripts': [
            'sat-cli=utils.entity.cli:main',
            'scen=utils.entity.cli:main',
        ]
    }
)
```

安装后可直接使用：
```bash
sat-cli validate scenarios/test.json
scen walker --help
```

### 1. 实体库管理

```bash
# 列出所有卫星模板（表格格式，使用 rich 库）
python -m utils.entity lib list --type satellite

# 查看模板详情
python -m utils.entity lib show satellite optical_1

# 添加新卫星模板（交互式向导）
python -m utils.entity lib add-satellite --id optical_3

# 添加点目标
python -m utils.entity lib add-target \
    --id nanjing \
    --name "南京目标" \
    --lon 118.8 \
    --lat 32.1 \
    --priority 7

# 删除模板
python -m utils.entity lib remove --type target --id old_target
```

### 2. 场景构建（支持 --dry-run）

```bash
# 初始化空场景（生成模板框架）
python -m utils.entity init scenarios/my_scenario.json

# 初始化场景并自动填充基础字段
python -m utils.entity init scenarios/my_scenario.json --with-metadata

# 生成场景模板（空框架示例）
{
  "name": "my_scenario",
  "description": "",
  "start_time": "2024-01-01T00:00:00Z",
  "end_time": "2024-01-02T00:00:00Z",
  "metadata": {
    "coordinate_system": "WGS84",
    "time_system": "UTC",
    "time_format": "ISO8601",
    "created_at": "2024-01-01T00:00:00Z",
    "version": "1.0"
  },
  "satellites": [],
  "targets": [],
  "ground_stations": []
}

# 克隆现有场景
python -m utils.entity clone scenarios/base.json --output scenarios/variant.json

# 向场景添加卫星（试运行，不实际写入）
python -m utils.entity add-to-scenario \
    scenarios/my_scenario.json \
    --entity-type satellite \
    --template optical_1 \
    --id OPT-01 \
    --raan 180.0 \
    --dry-run

# 批量添加目标（试运行，查看差异）
python -m utils.entity add-to-scenario \
    scenarios/my_scenario.json \
    --entity-type target \
    --from-file data/china_cities.json \
    --dry-run

# 生成 Walker 星座（试运行）
python -m utils.entity walker scenarios/test.json \
    --template optical_1 --planes 2 --sats-per-plane 3 \
    --dry-run

# 参数扫描（Parameter Sweep）- 批量生成场景矩阵
python -m utils.entity sweep \
    --base-scenario scenarios/base.json \
    --param satellites[0].capabilities.storage_capacity \
    --range 500:2000:100 \
    --output-dir scenarios/sweep_storage/

# 参数扫描（多参数组合）
python -m utils.entity sweep \
    --base-scenario scenarios/base.json \
    --param satellites[0].capabilities.storage_capacity --range 500:2000:100 \
    --param satellites[0].capabilities.power_capacity --range 2000:4000:200 \
    --output-dir scenarios/sweep_combined/

# 场景矩阵（Scenario Matrix）输出结构：
# scenarios/sweep_storage/
#   ├── base_storage_500.json
#   ├── base_storage_600.json
#   ├── base_storage_700.json
#   └── ...
```

**--dry-run 输出示例**：
```
=== 即将执行的变更 ===
[+] 添加卫星: WALKER-01-01
    轨道高度: 645000 m
    倾角: 97.9°
    RAAN: 180.0°

[+] 添加卫星: WALKER-01-02
    轨道高度: 645000 m
    倾角: 97.9°
    RAAN: 180.0°
    Mean Anomaly: 120.0°

...共 6 颗卫星

使用 --apply 确认执行，或移除 --dry-run 直接应用
```

**--dry-run 输出示例**：
```
=== 即将执行的变更 ===
[+] 添加卫星: WALKER-01-01
    轨道高度: 645000 m
    倾角: 97.9°
    RAAN: 180.0°

[+] 添加卫星: WALKER-01-02
    轨道高度: 645000 m
    倾角: 97.9°
    RAAN: 180.0°
    Mean Anomaly: 120.0°

...共 6 颗卫星

使用 --apply 确认执行，或移除 --dry-run 直接应用
```

### 3. 场景校验（rich 可视化输出）

```bash
# 基础校验（简洁输出）
python -m utils.entity validate scenarios/my_scenario.json

# 详细报告（彩色表格）
python -m utils.entity validate scenarios/my_scenario.json --verbose

# 可行性检查（可见性窗口）
python -m utils.entity check-feasibility scenarios/my_scenario.json

# 场景差异比对（类似 Git diff）
python -m utils.entity diff \
    scenarios/base.json \
    scenarios/variant.json

# 差异比对输出示例（rich 彩色表格）：
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ 场景差异比对                                      ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃ 基准场景: scenarios/base.json                     ┃
┃ 变体场景: scenarios/variant.json                  ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

卫星 [OPT-01]:
  capabilities.storage_capacity:
    500 -> 1000  (+500)
  capabilities.power_capacity:
    2000 -> 2000  (无变化)

卫星 [WALKER-01-01] (仅存在于变体场景):
  + 新增卫星
    轨道高度: 645000 m
    倾角: 97.9°

目标 [TARGET-003] (仅存在于基准场景):
  - 已删除
```

**模板版本警告（软规则）**:
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃           场景校验报告: my_scenario.json          ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃ 状态: ✅ 通过 (含 1 个警告)                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃  实体类型     ┃  数量    ┃  状态                 ┃
┣━━━━━━━━━━━━━━╋━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━┫
┃  卫星        ┃    6     ┃  ✅ 全部通过          ┃
┃  目标        ┃   50     ┃  ✅ 全部通过          ┃
┃  地面站      ┃    2     ┃  ✅ 全部通过          ┃
┗━━━━━━━━━━━━━━┻━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━┛

⚠️  警告:
   卫星 [OPT-01] 使用的是旧版模板
   场景模板版本: optical_1 v1.0
   实体库最新版本: optical_1 v2.0
   建议: 运行 `scen update-template --id OPT-01` 升级
```

**rich 可视化输出示例**：
```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃           场景校验报告: my_scenario.json          ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃ 状态: ✅ 通过                                     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃  实体类型     ┃  数量    ┃  状态                 ┃
┣━━━━━━━━━━━━━━╋━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━┫
┃  卫星        ┃    6     ┃  ✅ 全部通过          ┃
┃  目标        ┃   50     ┃  ✅ 全部通过          ┃
┃  地面站      ┃    2     ┃  ✅ 全部通过          ┃
┗━━━━━━━━━━━━━━┻━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━┛

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃  性能指标                                         ┃
┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫
┃  预计需求满足率: 85%                              ┃
┃  平均重访周期: 4.2 小时                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

### 4. Walker 星座生成

```bash
# Walker Delta 星座（默认相位因子 F=1）
python -m utils.entity walker \
    scenarios/my_scenario.json \
    --template optical_1 \
    --planes 2 \
    --sats-per-plane 3 \
    --raan-start 180.0 \
    --raan-spread 180.0 \
    --f-factor 1 \
    --prefix "WALKER"

# Walker Star 极轨道星座（F=0）
python -m utils.entity walker \
    scenarios/my_scenario.json \
    --template optical_1 \
    --planes 3 \
    --sats-per-plane 4 \
    --inclination 90.0 \
    --f-factor 0 \
    --prefix "POLAR"

# 参数说明:
# --planes (-p): 轨道面数 (P)
# --sats-per-plane (-s): 每轨道面卫星数 (S)
# --f-factor (-f): 相位因子 (0 to P-1)
# --raan-start: 第一个轨道面升交点赤经
# --raan-spread: 升交点赤经总分布范围
# --inclination (-i): 轨道倾角（覆盖模板默认值）
# 总卫星数 T = P × S

# Walker配置标准记法: i:T/P/F
# 示例: 97.9°:6/2/1 表示倾角97.9°，6颗卫星，2个轨道面，相位因子1

# Walker 快捷预设（常用星座配置）
python -m utils.entity walker \
    scenarios/my_scenario.json \
    --preset delta_24_3_1 \
    --template optical_1

# 可用预设列表:
# --preset delta_24_3_1   # GPS-like: 55°倾角, 24颗, 3面, F=1
# --preset delta_66_6_1   # 铱星升级版: 55°倾角, 66颗, 6面, F=1
# --preset star_24_3_0    # 极轨道: 90°倾角, 24颗, 3面, F=0
# --preset star_48_6_0    # 极轨道密集: 90°倾角, 48颗, 6面, F=0
# --preset delta_18_3_1   # 小型星座: 60°倾角, 18颗, 3面, F=1
```

## 校验规则

### 结构校验（JSON Schema）

- 必填字段完整性
- 数据类型正确性
- 数组长度范围
- 枚举值合法性

### 业务规则校验

| 实体 | 校验项 | 规则 |
|-----|-------|------|
| 卫星 | 轨道高度 | 300-1000 km |
| 卫星 | 倾角 | 0-180° |
| 卫星 | 偏心率 | 0-0.1 |
| 目标 | 经度 | -180° ~ 180° |
| 目标 | 纬度 | -90° ~ 90° |
| 目标 | 优先级 | 1-10 |
| 地面站 | 天线仰角 | 0-90° |
| 场景 | 时间格式 | ISO 8601 UTC (2024-01-01T00:00:00Z) |
| 场景 | 坐标系 | WGS84, 椭球体高程 |
| 场景 | 时间范围 | end_time > start_time |

## 实现要点

### 核心模块

```
utils/
├── entity/
│   ├── __init__.py
│   ├── cli.py                    # 命令行入口（含rich输出）
│   ├── library.py                # 实体库管理
│   ├── builder.py                # 场景构建器（支持继承/合并）
│   ├── validator.py              # 校验器（JSON Schema + 业务规则）
│   ├── walker.py                 # Walker星座生成（i:T/P/F参数）
│   ├── repository/               # 数据访问层抽象
│   │   ├── __init__.py
│   │   ├── base.py               # Repository基类
│   │   ├── json_repository.py    # JSON文件实现
│   │   └── db_repository.py      # 数据库存储（预留）
│   └── templates/                # 默认模板
│       ├── default_satellites.json
│       └── default_ground_stations.json
```

### 数据访问层抽象（Repository模式）

```python
from abc import ABC, abstractmethod
from typing import List, Optional

class EntityRepository(ABC):
    """实体库存储抽象接口，支持JSON文件或数据库存储"""

    @abstractmethod
    def get_satellite_template(self, template_id: str) -> Optional[dict]:
        pass

    @abstractmethod
    def list_satellite_templates(self) -> List[dict]:
        pass

    @abstractmethod
    def save_satellite_template(self, template: dict) -> None:
        pass

    @abstractmethod
    def get_target(self, target_id: str) -> Optional[dict]:
        pass

    @abstractmethod
    def query_targets_by_region(self, min_lon, max_lon, min_lat, max_lat) -> List[dict]:
        """按地理区域查询目标，支持数据库索引优化"""
        pass


class JSONEntityRepository(EntityRepository):
    """基于JSON文件的实体库实现（默认）"""
    def __init__(self, base_path: str = "data/entity_lib"):
        self.base_path = base_path

    def get_satellite_template(self, template_id: str) -> Optional[dict]:
        filepath = f"{self.base_path}/satellites/{template_id}.json"
        # 读取并返回...


class DBEntityRepository(EntityRepository):
    """基于关系型数据库的实体库实现（MySQL 8.0+ JSON类型支持）"""
    def __init__(self, connection_string: str):
        from sqlalchemy import create_engine
        from sqlalchemy.orm import declarative_base
        self.engine = create_engine(connection_string)
        self.Base = declarative_base()

    def query_targets_by_region(self, min_lon, max_lon, min_lat, max_lat) -> List[dict]:
        """使用空间索引（PostGIS）高效查询"""
        # SQL查询...


# MySQL JSON 列映射示例（SQLAlchemy ORM）
from sqlalchemy import Column, String, Float, Integer, JSON
from sqlalchemy.orm import declarative_base

Base = declarative_base()

class SatelliteORM(Base):
    """卫星实体ORM模型 - 兼容MySQL 8.0 JSON类型"""
    __tablename__ = 'satellites'

    id = Column(String(32), primary_key=True)
    name = Column(String(128), nullable=False)
    sat_type = Column(String(32), nullable=False)

    # 灵活字段使用JSON类型，保留现有Python校验逻辑
    orbit = Column(JSON, nullable=False)  # 存储轨道参数字典
    capabilities = Column(JSON, nullable=False)  # 存储能力配置字典
    metadata = Column(JSON, default=dict)  # 模板来源等元信息

    # 关键查询字段单独存储（便于索引和查询）
    altitude = Column(Float, index=True)
    inclination = Column(Float, index=True)
    storage_capacity = Column(Integer, index=True)

class TargetORM(Base):
    """目标实体ORM模型 - 空间索引支持"""
    __tablename__ = 'targets'

    id = Column(String(32), primary_key=True)
    name = Column(String(128), nullable=False)
    target_type = Column(String(16), nullable=False)  # 'point' | 'area'

    # 位置信息
    longitude = Column(Float, index=True)
    latitude = Column(Float, index=True)
    altitude = Column(Float, default=0.0)

    # 业务属性（JSON存储灵活字段）
    properties = Column(JSON, default=dict)
    priority = Column(Integer, default=5)
    required_observations = Column(Integer, default=1)

# 从JSON文件迁移到数据库时，保持字段结构一致
# 无需修改Python校验逻辑，只需更换Repository实现
```

### Docker 容器化与 CI/CD 集成

**Dockerfile**:
```dockerfile
FROM python:3.10-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
RUN pip install -e .

ENTRYPOINT ["sat-cli"]
```

**docker-compose.yml (本地开发持久化)**:
```yaml
version: '3.8'

services:
  scenario-tools:
    build: .
    image: mission-scenario:latest
    container_name: sat-scenario-cli
    volumes:
      # 实体库数据持久化
      - ./data/entity_lib:/app/data/entity_lib
      # 场景文件目录
      - ./scenarios:/app/scenarios
      # 输出结果目录
      - ./results:/app/results
    environment:
      - ENTITY_LIB_PATH=/app/data/entity_lib
      - SCENARIOS_PATH=/app/scenarios
    working_dir: /app
    command: ["validate", "/app/scenarios/production.json"]

  # 可选：MySQL 数据库服务（未来扩展）
  mysql:
    image: mysql:8.0
    container_name: sat-mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: mission_scenarios
      MYSQL_USER: mission_user
      MYSQL_PASSWORD: mission_pass
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"

volumes:
  mysql_data:
```

**使用 Docker Compose**:
```bash
# 启动服务并运行校验
docker-compose run --rm scenario-tools validate scenarios/test.json

# 进入交互式 shell
docker-compose run --rm scenario-tools bash

# 批量生成 Walker 星座
docker-compose run --rm scenario-tools \
  walker scenarios/base.json --preset delta_24_3_1

# 参数扫描
docker-compose run --rm scenario-tools \
  sweep --base-scenario scenarios/base.json \
  --param storage --range 500:2000:100
```

**GitHub Actions CI/CD 示例**:
```yaml
name: Scenario Validation

on:
  push:
    paths:
      - 'scenarios/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build Docker Image
        run: docker build -t mission-scenario:latest .

      - name: Validate Scenarios
        run: |
          for scenario in scenarios/*.json; do
            echo "Validating $scenario..."
            docker run --rm -v $(pwd):/app mission-scenario:latest \
              validate "/app/$scenario"
          done

      - name: Check Feasibility
        run: |
          docker run --rm -v $(pwd):/app mission-scenario:latest \
            check-feasibility /app/scenarios/production.json
```

### Walker 星座算法

Walker 星座标准配置由四个参数决定：**i:T/P/F**（倾角、总卫星数、轨道面数、相位因子）

```python
def generate_walker_delta(inclination, total_sats, n_planes, f_factor,
                         raan_start=0.0, raan_spread=360.0):
    """
    Walker Delta / Star 星座生成

    标准记法: i:T/P/F
    - i: 轨道倾角 (°)
    - T: 总卫星数 = P × S
    - P: 轨道面数
    - F: 相位因子 (0, 1, ..., P-1)

    几何关系:
    - 升交点赤经间隔: ΔΩ = raan_spread / P
    - 面内卫星间隔: ΔM_plane = 360° / S
    - 相邻面卫星相位差: ΔM_inter = F × 360° / T

    参数:
        inclination: 轨道倾角 (°)
        total_sats: 总卫星数 T
        n_planes: 轨道面数 P
        f_factor: 相位因子 F
        raan_start: 起始升交点赤经 (°)
        raan_spread: 升交点赤经分布范围 (°)

    返回:
        satellites: 卫星列表
    """
    n_sats_per_plane = total_sats // n_planes
    delta_raan = raan_spread / n_planes
    delta_m_plane = 360.0 / n_sats_per_plane

    satellites = []

    for p in range(n_planes):
        raan = raan_start + p * delta_raan
        for s in range(n_sats_per_plane):
            # 卫星在轨道面内序号 (0 to S-1)
            # 相位因子决定相邻轨道面卫星的相对位置
            phase_offset = (f_factor * n_sats_per_plane * s / total_sats) * 360.0
            mean_anomaly = (s * delta_m_plane + phase_offset) % 360.0

            sat_id = f"WALKER-{p+1:02d}-{s+1:02d}"
            satellites.append({
                'id': sat_id,
                'raan': raan,
                'mean_anomaly': mean_anomaly,
                'plane': p + 1,
                'sat_in_plane': s + 1
            })

    return satellites


# 常见Walker星座配置示例
WALKER_CONFIGS = {
    # Delta星座: 倾角 < 90°, F=1 为最常见配置
    'delta_24_3_1': {'i': 55.0, 'T': 24, 'P': 3, 'F': 1},  # GPS-like
    'delta_66_6_1': {'i': 55.0, 'T': 66, 'P': 6, 'F': 1},  # 铱星升级版

    # Star星座: 倾角 = 90° (极轨道), F=0 使卫星沿经线分布
    'star_24_3_0': {'i': 90.0, 'T': 24, 'P': 3, 'F': 0},
}
```

## 使用示例

### 完整工作流

```bash
# 1. 初始化实体库（创建默认模板）
python -m utils.entity lib init

# 2. 添加自定义卫星模板
python -m utils.entity lib add-satellite --id optical_custom

# 3. 创建新场景
python -m utils.entity build --output scenarios/test.json

# 4. 添加卫星
python -m utils.entity add-to-scenario scenarios/test.json \
    --template optical_1 --id SAT-01 --raan 180.0

# 5. 生成 Walker 星座
python -m utils.entity walker scenarios/test.json \
    --template optical_1 --planes 2 --sats-per-plane 3

# 6. 批量添加目标
python -m utils.entity add-to-scenario scenarios/test.json \
    --entity-type target --from-file data/china_cities.json

# 7. 校验场景
python -m utils.entity validate scenarios/test.json --verbose

# 8. 运行实验
python main.py --scenario scenarios/test.json --algorithm greedy
```

## 后续扩展

- [x] 全量数据存储（场景自包含）
- [x] 场景初始化功能（生成空场景模板）
- [x] Walker 星座相位因子参数化 (i:T/P/F)
- [x] 时间系统与坐标系标准化
- [x] --dry-run 试运行模式
- [x] CLI 短命令别名 (sat-cli, scen)
- [x] rich 终端可视化
- [x] 数据访问层抽象（Repository模式）
- [x] Docker 容器化与 CI/CD 集成
- [x] 参数扫描（Parameter Sweep）场景矩阵生成
- [x] 模板版本追踪与警告
- [x] 场景差异比对（scen diff）
- [x] Walker 星座快捷预设（--preset）
- [x] Docker Compose 本地持久化
- [x] MySQL 8.0 JSON 列设计
- [ ] GUI 可视化编辑器
- [ ] 在线实体库共享
- [ ] 自动优化建议（根据任务需求推荐卫星配置）

---

*文档版本: 3.1*
*更新日期: 2024-02-21*

## 更新日志

### v3.1
- **移除**场景继承机制（平行对比），改为全量数据存储
- **新增**场景初始化功能（`init` 命令生成空场景模板）
- 场景文件保证自包含，不依赖外部文件

### v3.0
- 新增参数扫描（Parameter Sweep）场景矩阵生成功能
- 新增模板版本追踪与警告（检测旧版模板并提示升级）
- 新增场景差异比对命令（scen diff，类似Git diff体验）
- 新增 Walker 星座快捷预设（--preset delta_24_3_1等）
- 新增 Docker Compose 配置（数据卷持久化）
- 新增 MySQL 8.0 JSON 列 ORM 映射设计（无缝迁移方案）

### v2.0
- 新增深拷贝机制，保证实验可复现性
- 修正 Walker 星座算法，支持标准 i:T/P/F 配置
- 增加时间系统 (ISO 8601 UTC) 和坐标系 (WGS84) 标准化
- 新增 --dry-run 试运行模式
- 新增 CLI 短命令别名 (sat-cli, scen)
- 新增 rich 终端可视化输出
- 新增 Repository 数据访问层抽象
- 新增 Docker 容器化与 CI/CD 集成方案

### v1.0
- 初始设计文档
- 实体库与场景构建架构
- 基础命令行接口
