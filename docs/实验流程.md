# 卫星星座任务规划算法实验流程文档

本文档详细描述卫星星座任务规划算法研究平台的核心实验流程。

---

## 目录

1. [场景配置流程](#1-场景配置流程)
2. [可见性计算流程](#2-可见性计算流程)
3. [算法执行流程](#3-算法执行流程)
4. [结果验证流程](#4-结果验证流程)
5. [性能评估流程](#5-性能评估流程)
6. [批量实验流程](#6-批量实验流程)

---

## 1. 场景配置流程

### 概述
定义实验的"环境"——卫星、载荷、目标、地面站等全部实体及其参数配置。

### 步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 1.1 定义卫星星座 | 配置轨道参数、平台资源 | TLE数据或轨道六根数 | `Satellite`对象列表 |
| 1.2a 定义载荷工作模式 | 配置成像载荷及工作模式 | 载荷规格 | 载荷配置对象 |
| 1.2b 定义目标集合 | 配置点目标或区域目标 | 地理数据/任务需求 | `Target`对象列表 |
| 1.3 定义地面站 | 配置天线、位置、数据率 | 地面站分布数据 | `GroundStation`对象列表 |
| 1.4 定义时间范围 | 设置仿真开始/结束时间 | 实验时间窗口 | 时间范围配置 |
| 1.5 序列化场景 | 保存为JSON/YAML配置文件 | 内存中的场景对象 | `scenarios/*.json` |

### 1.1 卫星星座配置

**卫星类型定义**：

| 卫星类型 | 载荷类型 | 存储容量 | 电池容量 | 适用场景 |
|---------|---------|---------|---------|---------|
| OPTICAL_1 | 光学推扫 | 500 GB | 2000 Wh | 大面积普查 |
| OPTICAL_2 | 光学框幅 | 800 GB | 2500 Wh | 点目标详查 |
| SAR_1 | SAR条带 | 1000 GB | 3000 Wh | 全天候普查 |
| SAR_2 | SAR聚束 | 1500 GB | 4000 Wh | 高分辨率详查 |

### 1.2a 载荷工作模式配置（核心）

#### 1.2a.1 成像载荷类型选择

```
┌─────────────────────────────────────────────────────────────┐
│                    载荷类型选择矩阵                          │
├─────────────────┬─────────────────┬─────────────────────────┤
│    卫星类型      │    载荷类型      │        适用场景          │
├─────────────────┼─────────────────┼─────────────────────────┤
│   OPTICAL_1     │    光学推扫      │   大面积普查、土地利用    │
│   OPTICAL_2     │    光学框幅      │   点目标详查、目标识别    │
│   SAR_1         │   SAR条带        │   全天候普查、海洋监测    │
│   SAR_2         │   SAR聚束        │   高分辨率详查、干涉测量  │
└─────────────────┴─────────────────┴─────────────────────────┘
```

#### 1.2a.2 成像模式详细配置

**光学载荷工作模式**：

| 模式 | 英文 | 描述 | 典型参数 |
|-----|------|------|---------|
| 推扫 | PushBroom | 探测器沿轨道方向推扫 | 幅宽: 20km, 分辨率: 2m |
| 框幅 | Frame | 单次曝光获取矩形区域 | 幅宽: 10km×10km, 分辨率: 0.5m |
| 视频 | Video | 对固定区域连续成像 | 帧率: 30fps, 持续时间: 60s |

**SAR载荷工作模式**：

| 模式 | 英文 | 描述 | 典型参数 |
|-----|------|------|---------|
| 条带 | StripMap | 固定天线指向，连续条带成像 | 幅宽: 30km, 分辨率: 3m |
| 聚束 | Spotlight | 天线持续照射同一点 | 幅宽: 5km, 分辨率: 0.3m |
| 扫描 | ScanSAR | 波束扫描扩展幅宽 | 幅宽: 100km, 分辨率: 20m |
| 滑动聚束 | SlidingSpotlight | 聚束与条带折中 | 幅宽: 15km, 分辨率: 1m |

#### 1.2a.3 分辨率-幅宽权衡配置

```yaml
# SAR_2 卫星载荷模式配置示例
payload_modes:
  spotlight:
    name: "聚束模式"
    resolution: 0.3           # 米
    swath_width: 5            # 公里
    max_imaging_duration: 10  # 秒
    power_consumption: 800    # 瓦
    data_rate: 500            # Mbps

  sliding_spotlight:
    name: "滑动聚束模式"
    resolution: 1.0
    swath_width: 15
    max_imaging_duration: 30
    power_consumption: 700
    data_rate: 400

  stripmap:
    name: "条带模式"
    resolution: 3.0
    swath_width: 30
    max_imaging_duration: 60
    power_consumption: 600
    data_rate: 300
```

#### 1.2a.4 成像时间参数

```
成像任务时间线
─────────────────────────────────────────────────────────────►

│←── 准备时间 ──→│←──── 实际成像时间 ────→│←── 关机时间 ──→│
    (卫星机动)          (载荷工作)            (稳定/关机)

    │                  │                     │
    ▼                  ▼                     ▼
┌─────────┐      ┌──────────┐           ┌─────────┐
│ 姿态机动 │ ──→ │  成像    │ ──→      │ 姿态回稳 │
│ 载荷预热 │      │ (推扫等) │           │ 数据记录 │
└─────────┘      └──────────┘           └─────────┘
```

| 阶段 | 时间范围 | 说明 |
|-----|---------|------|
| 准备时间 | 5-15秒 | 卫星姿态机动到目标、载荷预热 |
| 成像时间 | 根据模式 | 与幅宽、卫星速度相关 |
| 关机时间 | 3-10秒 | 载荷冷却、姿态稳定、数据落盘 |

#### 1.2a.5 功耗参数配置

```
功耗状态机
                    ┌──────────────┐
    ┌───────────────│    待机      │◄────────────────┐
    │               │ (Standby)    │                 │
    │               │  50W         │                 │
    │               └──────┬───────┘                 │
    │                      │ 成像指令                  │
    │                      ▼                         │
    │               ┌──────────────┐    完成         │
    └── 关机/异常 ──│    成像      │───────────────→┘
                    │ (Imaging)    │
                    │  600-800W    │
                    │ (与模式相关)  │
                    └──────────────┘
                           │
                           ▼ 数据下传
                    ┌──────────────┐
                    │   数据发射    │
                    │ (Downlink)   │
                    │  200W        │
                    └──────────────┘
```

**功耗配置表**：

| 载荷类型 | 待机功耗 | 成像功耗范围 | 下传功耗 |
|---------|---------|-------------|---------|
| Optical-1 | 40W | 200-300W | 150W |
| Optical-2 | 50W | 300-400W | 180W |
| SAR-1 | 60W | 500-700W | 200W |
| SAR-2 | 80W | 600-800W | 250W |

#### 1.2a.6 存储占用计算

```
数据量计算公式
─────────────────────────────────────────────────

单景数据量 = 幅宽(km) × 成像长度(km) × 分辨率(m) × 量化位数 × 波段数

示例：SAR聚束模式
- 幅宽: 5km
- 成像长度: 10km
- 分辨率: 0.3m → 像素数 = 5000/0.3 ≈ 16667
- 量化: 16bit = 2字节
- 单极化

数据量 = 16667 × 33333 × 2 ≈ 1.1 GB
```

**各模式存储占用参考**：

| 模式 | 单景数据量 | 每小时最大数据量 |
|-----|-----------|----------------|
| 光学推扫 | 0.5-2 GB | 20 GB |
| 光学框幅 | 0.1-0.5 GB | 10 GB |
| SAR条带 | 2-5 GB | 30 GB |
| SAR聚束 | 1-3 GB | 15 GB |
| SAR扫描 | 5-10 GB | 50 GB |

### 配置文件示例

```json
{
  "scenario_name": "large_area_imaging",
  "time_range": {
    "start": "2024-01-01T00:00:00Z",
    "end": "2024-01-01T12:00:00Z"
  },
  "satellites": [
    {
      "id": "SAT-001",
      "type": "SAR_2",
      "tle": ["line1", "line2"],
      "resources": {
        "storage_gb": 1000,
        "battery_wh": 3000
      },
      "payload": {
        "type": "SAR",
        "modes": {
          "spotlight": {
            "resolution_m": 0.3,
            "swath_km": 5,
            "max_duration_s": 10,
            "prep_time_s": 10,
            "cooldown_s": 5,
            "power_w": 800,
            "data_rate_mbps": 500
          },
          "sliding_spotlight": {
            "resolution_m": 1.0,
            "swath_km": 15,
            "max_duration_s": 30,
            "prep_time_s": 8,
            "cooldown_s": 4,
            "power_w": 700,
            "data_rate_mbps": 400
          }
        }
      }
    }
  ],
  "targets": [],
  "ground_stations": []
}
```

---

## 2. 可见性计算流程

### 概述
预先计算所有卫星-目标的访问时间窗口，为算法执行提供基础数据。

### 步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 2.1 选择轨道传播器 | 根据精度要求选择后端 | 配置参数 | 传播器实例 |
| 2.2 计算卫星位置 | 按时间步长计算星历 | 轨道参数、时间范围 | 位置/速度时间序列 |
| 2.3 计算访问窗口 | 计算卫星-目标可见时段 | 卫星位置、目标位置 | 原始访问窗口 |
| 2.4 过滤地影期 | 排除卫星在地影中的时段 | 太阳位置、卫星位置 | 有效访问窗口 |
| 2.5 应用仰角约束 | 过滤低于最小仰角的窗口 | 最小仰角配置 | 过滤后的窗口 |
| 2.6 缓存结果 | 序列化窗口数据 | 窗口数据 | 缓存文件/内存对象 |

### 关键决策

**精度vs效率权衡**：

| 传播器 | 精度 | 速度 | 适用场景 |
|-------|------|------|---------|
| SGP4 | 中 | 最快 | 低轨短期预测、快速验证 |
| STK HPOP | 最高 | 慢 | 需要高精度（考虑大气阻力、太阳光压） |
| Orekit | 高 | 中等 | 开源免费，精度足够大多数实验 |

**时间步长选择**：

| 粒度 | 步长 | 适用场景 |
|-----|------|---------|
| 粗粒度 | 60s | 快速估算，可能漏窗口 |
| 标准粒度 | 10s | 平衡选择，推荐默认 |
| 细粒度 | 1s | 高精度需求，计算慢 |

---

## 3. 算法执行流程

### 概述
运行调度算法生成任务分配方案。

### 通用步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 3.1 初始化调度器 | 创建算法实例，设置参数 | 算法名称、超参数 | 调度器实例 |
| 3.2 加载可见性窗口 | 从缓存读取预计算的窗口 | 窗口缓存 | 窗口字典 |
| 3.3 生成初始解 | 构建初始任务分配方案 | 目标列表、卫星列表 | 初始解 |
| 3.4 迭代优化 | 执行算法核心循环 | 初始解、约束条件 | 中间解序列 |
| 3.5 收敛判断 | 检查终止条件 | 收敛曲线 | 是否继续标志 |
| 3.6 提取最终解 | 提取最优解 | 算法内部状态 | 任务分配方案 |

### 支持的算法

| 算法 | 类型 | 核心机制 |
|-----|------|---------|
| Greedy | 启发式 | 优先级排序 + 最佳分配 |
| EDD | 启发式 | 最早截止时间优先 |
| SPT | 启发式 | 最短处理时间优先 |
| GA | 元启发式 | 遗传进化（选择、交叉、变异） |
| SA | 元启发式 | 模拟退火（温度、邻域、接受准则） |
| ACO | 元启发式 | 蚁群优化（信息素、启发函数） |
| PSO | 元启发式 | 粒子群（速度、位置更新） |
| Tabu | 元启发式 | 禁忌搜索（禁忌表、邻域） |

### 遗传算法详细流程

```
遗传算法执行流程
────────────────────────────────────────

初始化
  │
  ├── 3.3.1 初始化种群（100个体）
  │   └── 随机生成染色体（任务-卫星编码）
  │
  └── 3.3.2 评估适应度
      └── Fitness = w1×DSR + w2×(1-Makespan/Tmax)

迭代（最多200代）
  │
  ├── 3.4.1 选择：锦标赛选择（选择压力）
  │
  ├── 3.4.2 交叉：单点/多点交叉（概率0.8）
  │
  ├── 3.4.3 变异：随机重分配（概率0.2）
  │
  ├── 3.4.4 精英保留：前10%直接进入下一代
  │
  └── 3.4.5 评估新一代适应度

终止判断
  │
  ├── 达到最大代数（200）→ 终止
  ├── 收敛（最优值10代不变）→ 终止
  └── 否则 → 继续迭代
```

---

## 4. 结果验证流程

### 概述
检查调度方案的可行性，分析未调度任务的失败原因。

### 步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 4.1 时间冲突检测 | 检查成像时间是否重叠 | 任务分配方案 | 时间冲突列表 |
| 4.2 资源约束验证 | 检查功率/存储/热控是否超限 | 卫星状态轨迹 | 资源违规列表 |
| 4.3 能力匹配验证 | 检查卫星是否具备所需能力 | 卫星能力、目标需求 | 能力不匹配列表 |
| 4.4 窗口约束验证 | 检查任务是否在可见窗口内 | 访问窗口、任务时间 | 窗口违规列表 |
| 4.5 分类失败原因 | 对未调度任务按原因分类 | 未调度任务列表 | 失败原因统计 |
| 4.6 生成验证报告 | 汇总验证结果 | 各类验证结果 | 验证报告对象 |

### 失败原因分类

| 类别 | 具体原因 | 说明 |
|-----|---------|------|
| 资源不足 | `INSUFFICIENT_POWER` | 功率预算不足 |
| 资源不足 | `INSUFFICIENT_STORAGE` | 存储容量不足 |
| 资源不足 | `THERMAL_LIMIT_EXCEEDED` | 热控限制 |
| 时间冲突 | `SATELLITE_TIME_CONFLICT` | 卫星时间冲突 |
| 时间冲突 | `GROUND_STATION_CONFLICT` | 地面站冲突 |
| 可见性 | `NO_VISIBILITY_WINDOW` | 无可见窗口 |
| 可见性 | `WINDOW_TOO_SHORT` | 窗口时间不足 |
| 能力 | `CAPABILITY_MISMATCH` | 能力不匹配 |

---

## 5. 性能评估流程

### 概述
计算各类性能指标，评估算法表现。

### 步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 5.1 计算需求满足率 | 已调度任务数 / 总任务数 | 调度结果 | DSR (0-1) |
| 5.2 计算完工时间 | 最后一个任务的完成时间 | 任务完成时间列表 | Makespan (秒) |
| 5.3 计算平均等待时间 | 任务从就绪到开始的平均时间 | 任务时间数据 | Avg Wait Time |
| 5.4 计算卫星利用率 | 成像时间 / 可用时间 | 卫星调度甘特图 | Utilization (0-1) |
| 5.5 计算计算时间 | 算法实际运行时间 | 计时器数据 | Computation Time |
| 5.6 计算综合质量 | 加权组合多个指标 | 各单项指标 | Solution Quality |

### 综合质量计算公式

```
SolutionQuality = w1 × DSR + w2 × (1 - Makespan/MaxPossible) + w3 × AvgUtilization

默认权重：
- w1 = 0.5 (需求满足率最重要)
- w2 = 0.3 (完工时间次之)
- w3 = 0.2 (利用率)
```

### 指标汇总表

| 指标 | 公式 | 说明 |
|-----|------|------|
| DSR | Scheduled / Total | 需求满足率 |
| Makespan | max(CompletionTime) | 完工时间 |
| AvgWait | avg(StartTime - ReleaseTime) | 平均等待时间 |
| Utilization | ImagingTime / AvailableTime | 卫星利用率 |
| CompTime | AlgorithmExecutionTime | 计算时间 |

---

## 6. 批量实验流程

### 概述
系统化比较多个算法在多个场景上的表现，确保统计显著性。

### 步骤分解

| 步骤 | 操作 | 输入 | 输出 |
|-----|------|------|------|
| 6.1 配置实验计划 | 定义要测试的算法和场景列表 | 算法列表、场景列表 | `ExperimentConfig` |
| 6.2 预计算所有窗口 | 为所有场景预计算可见性 | 场景列表 | 窗口缓存池 |
| 6.3 执行单次实验 | 运行单个算法在单个场景上 | 场景、算法、窗口 | 单次结果 |
| 6.4 重复实验 | 多次运行以获得统计显著性 | 重复次数N | N次结果列表 |
| 6.5 统计分析 | 计算均值、标准差、置信区间 | 重复实验结果 | 统计摘要 |
| 6.6 生成对比报告 | 交叉比较所有算法表现 | 所有实验结果 | 对比报告/图表 |

### 实验配置示例

```python
ExperimentConfig(
    repetitions=10,           # 每个算法-场景组合运行10次
    random_seed=None,         # 使用不同随机种子
    algorithms=['greedy', 'ga', 'sa', 'aco', 'pso'],
    scenarios=[
        'scenarios/small_10sats.json',
        'scenarios/medium_30sats.json',
        'scenarios/large_50sats.json'
    ],
    output_dir='./results/benchmark_2024/'
)
```

### 统计分析方法

```
统计指标
├── 集中趋势
│   ├── 均值 (Mean)
│   └── 中位数 (Median)
│
├── 离散程度
│   ├── 标准差 (StdDev)
│   └── 变异系数 (CV = StdDev/Mean)
│
└── 置信区间
    └── 95% CI (Mean ± 1.96 × SEM)
```

---

## 流程依赖关系

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   1.场景配置     │────→│  2.可见性计算   │────→│  3.算法执行     │
│  (定义实验环境)  │     │  (预计算窗口)   │     │  (生成调度方案)  │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                              ┌─────────────────────────┼─────────────────────────┐
                              ↓                         ↓                         ↓
                       ┌─────────────┐           ┌─────────────┐           ┌─────────────┐
                       │ 4.结果验证  │←────────→│ 5.性能评估  │←────────→│ 6.批量实验  │
                       │(检查可行性) │           │(计算指标)   │           │(系统比较)   │
                       └─────────────┘           └─────────────┘           └─────────────┘
```

---

## 附录

### A. 项目目录结构

```
missionPlanAlgo/
├── core/                    # 核心层
│   ├── models/             # 实体模型
│   ├── orbit/              # 轨道模块
│   ├── resources/          # 资源管理
│   ├── decomposer/         # 目标分解
│   ├── validators/         # 约束验证
│   └── ...
├── payload/                # 载荷模块
├── scheduler/              # 调度算法
│   ├── greedy/            # 启发式算法
│   └── metaheuristic/     # 元启发式算法
├── simulator/             # 仿真引擎
├── evaluation/            # 性能评估
├── experiments/           # 实验管理
├── visualization/         # 可视化
└── scenarios/             # 场景配置
```

### B. 运行入口

```bash
# 单次运行
python main.py --scenario scenarios/point_group_scenario.json --algorithm ga

# 批量实验
python -m experiments.runner \
    --scenario scenarios/benchmark_set.json \
    --algorithms greedy,edd,ga,sa,aco,pso \
    --output results/benchmark/
```

---

*文档版本: 1.0*
*最后更新: 2024-02-21*
